<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd"><!-- saved from url=(0055)fear-of-macros.htm --><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><HTML><HEAD><META 
content="IE=11.0000" http-equiv="X-UA-Compatible">
<META http-equiv="content-type" content="text/html; charset=utf-8"><META name="viewport" 
content="width=device-width, initial-scale=0.8"><TITLE>Fear of 
Macros</TITLE><LINK title="default" href="fear-of-macros_files/scribble.css" 
rel="stylesheet" type="text/css"><LINK title="default" href="fear-of-macros_files/racket.css" 
rel="stylesheet" type="text/css"><LINK title="default" href="fear-of-macros_files/manual-style.css" 
rel="stylesheet" type="text/css"><LINK title="default" href="fear-of-macros_files/manual-racket.css" 
rel="stylesheet" type="text/css"><LINK title="default" href="fear-of-macros_files/gh.css" 
rel="stylesheet" type="text/css">
<SCRIPT src="fear-of-macros_files/scribble-common.js" type="text/javascript"></SCRIPT><SCRIPT src="fear-of-macros_files/manual-racket.js" type="text/javascript"></SCRIPT><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--><META name="keywords" content="Racket, macros, Scheme"><META name="description" content="Practical Racket macros"><META name="author" content="Greg Hendershott"><META name="charset" content="utf-8"><META name="GENERATOR" content="MSHTML 11.00.9600.19204"></HEAD><BODY id="scribble-racket-lang-org"><DIV class="tocset"><DIV class="tocview"><DIV class="tocviewlist tocviewlisttopspace"><DIV class="tocviewtitle"><TABLE cellspacing="0" cellpadding="0">  <TBODY>  <TR>    <TD style="width: 1em;"><A title="Expand/Collapse" class="tocviewtoggle" 
      onclick='TocviewToggle(this,"tocview_0");' 
    href="javascript:void(0);">►</A></TD>    <TD></TD>    <TD><A class="tocviewselflink" href="https://www.greghendershott.com/fear-of-macros/" 
      data-pltdoc="x">Fear of Macros</A></TD></tr>
</TBODY></TABLE></DIV><DIV class="tocviewsublistonly" id="tocview_0" style="display: none;"><TABLE cellspacing="0" cellpadding="0">  <TBODY>  <TR>    <TD align="right">1&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.Preface%29" 
      data-pltdoc="x">Предисловие</A></TD></tr>

  <TR>
    <TD align="right">2&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.Our_plan_of_attack%29" 
      data-pltdoc="x">Наш план атаки</A></TD></tr>

  <TR>
    <TD align="right">3&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.Transform_%29" 
      data-pltdoc="x">Преобразование(Transform)!</A></TD></tr>

  <TR>
    <TD align="right">4&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._pattern-matching%29" 
      data-pltdoc="x">Сопоставление с образцом:<SPAN class="mywbr"> &nbsp;</SPAN> 
      syntax-<WBR>case and syntax-<WBR>rules</A></TD></tr>  <TR>    <TD align="right">5&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.Syntax_parameters%29" 
      data-pltdoc="x">Синтаксические параметры</A></TD></tr>

  <TR>
    <TD align="right">6&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.What_s_the_point_of_splicing-let_%29" 
      data-pltdoc="x">Какой смысл <SPAN class="RktSym"><SPAN class="RktStxLink">splicing-<WBR>let</SPAN></SPAN>?</A></TD></tr>

  <TR>
    <TD align="right">7&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.Robust_macros__syntax-parse%29" 
      data-pltdoc="x">Надежные макросы:<SPAN class="mywbr"> &nbsp;</SPAN> 
      syntax-<WBR>parse</A></TD></tr>  <TR>    <TD align="right">8&nbsp;</TD>    <TD><A class="tocviewlink" href="fear-of-macros.htm#%28part._.References_and_.Acknowledgments%29" 
      data-pltdoc="x">Ссылки и Благодарности</A></TD></tr>
</TBODY></TABLE></DIV></DIV></DIV><DIV class="tocsub"><TABLE class="tocsublist" cellspacing="0">  <TBODY>  <TR>    <TD><SPAN class="tocsublinknumber"></SPAN><A class="tocsubseclink" href="fear-of-macros.htm#%28part._.Fear_of_.Macros%29" 
      data-pltdoc="x">Боязнь Макросов</A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">1<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Preface%29" 
      data-pltdoc="x">Предисловие</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">2<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Our_plan_of_attack%29" 
      data-pltdoc="x">Наш план атаки</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Transform_%29" 
      data-pltdoc="x">Преобразование!</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3.1<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.What_is_a_syntax_transformer_%29" 
      data-pltdoc="x">Что такое синтаксический преобразователь?</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3.2<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.What_s_the_input_%29" 
      data-pltdoc="x">Какой вход?</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3.3<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Actually_transforming_the_input%29" 
      data-pltdoc="x">Фактическое преобразование входа</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3.4<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Compile_time_vs__run_time%29" 
      data-pltdoc="x">Время компиляции против времени выполнения</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">3.5<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._begin-for-syntax%29" 
      data-pltdoc="x"><SPAN class="RktSym"><SPAN 
      class="RktStxLink">begin-<WBR>for-<WBR>syntax</SPAN></SPAN></A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">4<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._pattern-matching%29" 
      data-pltdoc="x">Сопоставление с образцом:<SPAN class="mywbr"> &nbsp;</SPAN> 
      syntax-<WBR>case и syntax-<WBR>rules</A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">4.1<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Pattern_variable_vs__template---fight_%29" 
      data-pltdoc="x">Переменные образца против template—<WBR>fight!</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">4.1.1<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._with-syntax%29" 
      data-pltdoc="x"><SPAN class="RktSym"><SPAN 
      class="RktStxLink">with-<WBR>syntax</SPAN></SPAN></A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">4.1.2<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._with-syntax_%29" 
      data-pltdoc="x"><SPAN class="RktSym"><SPAN 
      class="RktStxLink">with-<WBR>syntax*</SPAN></SPAN></A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">4.1.3<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._format-id%29" 
      data-pltdoc="x"><SPAN class="RktSym"><SPAN 
      class="RktValLink">format-<WBR>id</SPAN></SPAN></A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">4.1.4<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Another_example%29" 
      data-pltdoc="x">Другой Пример</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">4.2<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Making_our_own_struct%29" 
      data-pltdoc="x">Создание собственной <SPAN class="RktSym"><SPAN class="RktStxLink">struct</SPAN></SPAN></A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">4.3<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._hash..refs%29" 
      data-pltdoc="x">Использование точечной нотации для поиска по вложенным хешам</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">5<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Syntax_parameters%29" 
      data-pltdoc="x">Синтаксические параметры</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">6<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.What_s_the_point_of_splicing-let_%29" 
      data-pltdoc="x">Какой смысл в <SPAN class="RktSym"><SPAN class="RktStxLink">splicing-<WBR>let</SPAN></SPAN>?</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">7<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Robust_macros__syntax-parse%29" 
      data-pltdoc="x">Надежные макросы:<SPAN class="mywbr"> &nbsp;</SPAN> 
      syntax-<WBR>parse</A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">7.1<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Error-handling_strategies_for_functions%29" 
      data-pltdoc="x">Error-<WBR>Стратегии обработки ошибок для функций</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">7.2<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Error-handling_strategies_for_macros%29" 
      data-pltdoc="x">Error-<WBR>Стратегии обработки ошибок для макросов</A></TD></tr>  <TR>    <TD><SPAN class="tocsublinknumber">7.3<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.Using_syntax-parse%29" 
      data-pltdoc="x">Использование <SPAN class="RktSym"><SPAN 
      class="RktStxLink">syntax-<WBR>parse</SPAN></SPAN></A></TD></tr>

  <TR>
    <TD><SPAN class="tocsublinknumber">8<TT>&nbsp;</TT></SPAN><A class="tocsubseclink" 
      href="fear-of-macros.htm#%28part._.References_and_.Acknowledgments%29" 
      data-pltdoc="x">Ссылки и благодарности</A></TD></tr></TBODY></TABLE></DIV></DIV><DIV class="maincolumn"><DIV class="main"><H2><A name="(part._.Fear_of_.Macros)"></A>Боязнь Макросов</H2><DIV class="SAuthorListBox"><SPAN class="SAuthorList"><P class="author"><A href="http://www.greghendershott.com/">Greg 
Hendershott</A></p>
</SPAN></DIV><p><DIV class="SIntrapara"></DIV><DIV class="SIntrapara"><IMG alt="" src="fear-of-macros_files/fear-of-macros.jpg"> </DIV><DIV class="SIntrapara">Практическое руководство по макросам <A href="https://www.racket-lang.org/">Racket</A> .</DIV><DIV class="SIntrapara"><SPAN class="Smaller">Copyright (c) 2012-2019 by Greg 
Hendershott. All rights reserved.</SPAN></DIV>
<DIV class="SIntrapara"><SPAN class="Smaller">Last updated 
2019-04-15T08:25:32</SPAN></DIV>
<DIV class="SIntrapara">Feedback and corrections are <A href="https://github.com/greghendershott/fear-of-macros/issues">welcome 
here</A>.</DIV>
<p></p><TABLE cellspacing="0" cellpadding="0">  <TBODY>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.Preface%29" 
      data-pltdoc="x">1<SPAN class="hspace">&nbsp;</SPAN>Введение</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.Our_plan_of_attack%29" 
      data-pltdoc="x">2<SPAN class="hspace">&nbsp;</SPAN>Наш план атаки</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.Transform_%29" 
      data-pltdoc="x">3<SPAN 
class="hspace">&nbsp;</SPAN>Преобразователь!</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.What_is_a_syntax_transformer_%29" 
      data-pltdoc="x">3.1<SPAN class="hspace">&nbsp;</SPAN>Что такое синтаксический преобразователь?</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.What_s_the_input_%29" 
      data-pltdoc="x">3.2<SPAN class="hspace">&nbsp;</SPAN>Какой вход?</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Actually_transforming_the_input%29" 
      data-pltdoc="x">3.3<SPAN class="hspace">&nbsp;</SPAN>Фактическое преобразование 
      входа</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Compile_time_vs__run_time%29" 
      data-pltdoc="x">3.4<SPAN class="hspace">&nbsp;</SPAN>Время компиляции против
времени ввыполнения</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._begin-for-syntax%29" 
      data-pltdoc="x">3.5<SPAN class="hspace">&nbsp;</SPAN><SPAN 
      class="RktSym"><SPAN 
      class="RktStxLink">begin-for-syntax</SPAN></SPAN></A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._pattern-matching%29" 
      data-pltdoc="x">4<SPAN class="hspace">&nbsp;</SPAN>Сопоставление с образцом: 
      syntax-case и syntax-rules</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Pattern_variable_vs__template---fight_%29" 
      data-pltdoc="x">4.1<SPAN class="hspace">&nbsp;</SPAN>Переменные образца против 
      template—<WBR>fight!</A></p>
</TD></tr>  <TR>    <TD><p><SPAN 
      class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._with-syntax%29" 
      data-pltdoc="x">4.1.1<SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><SPAN 
      class="RktStxLink">with-syntax</SPAN></SPAN></A></p></TD></tr>  <TR>    <TD><p><SPAN 
      class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._with-syntax_%29" 
      data-pltdoc="x">4.1.2<SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><SPAN 
      class="RktStxLink">with-syntax*</SPAN></SPAN></A></p></TD></tr>  <TR>    <TD><p><SPAN 
      class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._format-id%29" 
      data-pltdoc="x">4.1.3<SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><SPAN 
      class="RktValLink">format-id</SPAN></SPAN></A></p></TD></tr>  <TR>    <TD><p><SPAN 
      class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Another_example%29" 
      data-pltdoc="x">4.1.4<SPAN class="hspace">&nbsp;</SPAN>Другой 
      пример</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Making_our_own_struct%29" 
      data-pltdoc="x">4.2<SPAN class="hspace">&nbsp;</SPAN>Создание собственной <SPAN 
      class="RktSym"><SPAN class="RktStxLink">struct</SPAN></SPAN></A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._hash..refs%29" 
      data-pltdoc="x">4.3<SPAN class="hspace">&nbsp;</SPAN>Использование точечной 
      нотации для поиска по вложенным хешам</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.Syntax_parameters%29" 
      data-pltdoc="x">5<SPAN class="hspace">&nbsp;</SPAN>Синтаксические 
      параметры</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.What_s_the_point_of_splicing-let_%29" 
      data-pltdoc="x">6<SPAN class="hspace">&nbsp;</SPAN>Какой смысл в 
      <SPAN class="RktSym"><SPAN 
      class="RktStxLink">splicing-let</SPAN></SPAN>?</A></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.Robust_macros__syntax-parse%29" 
      data-pltdoc="x">7<SPAN class="hspace">&nbsp;</SPAN>Надежные макросы: 
      syntax-parse</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Error-handling_strategies_for_functions%29" 
      data-pltdoc="x">7.1<SPAN class="hspace">&nbsp;</SPAN>Стратегии обработки ошибок
      для функций</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Error-handling_strategies_for_macros%29" 
      data-pltdoc="x">7.2<SPAN class="hspace">&nbsp;</SPAN>Стратегии обработки ошибок
      для макросов</A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A 
      class="toclink" href="fear-of-macros.htm#%28part._.Using_syntax-parse%29" 
      data-pltdoc="x">7.3<SPAN class="hspace">&nbsp;</SPAN>Использование <SPAN class="RktSym"><SPAN 
      class="RktStxLink">syntax-parse</SPAN></SPAN></A></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace"></SPAN></p></TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class="toptoclink" 
      href="fear-of-macros.htm#%28part._.References_and_.Acknowledgments%29" 
      data-pltdoc="x">8<SPAN class="hspace">&nbsp;</SPAN>Ссылки и благодарности
      </A></p>
</TD></tr></TBODY></TABLE><H3>1<TT>&nbsp;</TT><A name="(part._.Preface)"></A>Предисловие</H3><p>Я изучил <A href="https://www.racket-lang.org/">Racket</A> после 25 лет использования
 C и C++.</p>
<p>В результате возник какой то психологический бич.</p><p>"Все скобки" на самом деле не имели большого значения. Вместо этого первым
изменением в мозге было функциональное программирование. Вскоре оно стало моим
образом мышления и я стал чувствовать себя комфортно и эффективно и по многим другим
особенностям Racket.</p>
<p>Но остались два последних рубежа: Макросы и продолжения.</p><p>Я обнаружил что простые макросы были просты и понятны, плюс много хороших учебных
пособий. Но в тот момент когда я прошёл обычное сопоставление с образцом
(pattern-matching), я как бы упал с обрыва в терминологическую кашу. Я
мариновал себя в этом материале, надеясь, что он в конечно итоге будет освоен
после достаточного перечитывания. Я даже обнаружил, что использую метод проб и
ошибок, а не чёткую мысленную модель происходящего. Блин.</p>
<p>Я начал писать это эссе когда очертания фигур медленно стали появляться из тумана.</p><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Если у вас есть какие-либо исправления, критика, жалобы или что-то еще, <A 
      href="https://github.com/greghendershott/fear-of-macros/issues">пожалуйста дайтем
      мне знать</A>.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><p>Мой основной мотив эгоистичен. Объяснение чего-либо заставляет меня изучать это
более тщательно. Плюс, если я напишу что-нибудь с ошибками, другие люди будут 
стремиться указать на них и исправить меня. Это социально-инженерная разновидность
метапрограммирования? Следующий вопрос, пожалуйста. :)</p>
<p>Наконец, я надеюсь, что это сможет помочь другим людям, которые имеют такой же 
жизненный опыт и/или стиль обучения, что и я.</p>
<p>Я хочу показать, как функции макросов Racket развивались как решения проблем
или неприятностей. Я учусь быстрее и глубже, когда узнаю ответ на вопрос, который 
у меня уже есть, или нахожу решение проблемы, боль которой я уже чувствую. Поэтому
сначала я дам вам вопросы и проблемы, чтобы вы смогли лучше оценить и понять ответы
и решения.</p><H3>2<TT>&nbsp;</TT><A name="(part._.Our_plan_of_attack)"></A>Наш план 
атаки</H3>
<p>Система макросов, которую вы в основном захотите использовать для создания
качественных макросов называется 
<SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>. И не волнуйтесь, мы скоро к этому вернемся.
</p><p>Но если мы начнем с нее, вы вероятно, почувствуете, что ошеломлены концепциями
и терминологией, и очень запутаетесь. Я сделал такой план:</p>
<p>1. Вместо этого, давайте начнем с основ: синтаксического объекта и функции
его изменения—<WBR> "преобразователя". Мы немного поработаем на этом уровне,
чтобы освоиться и демифологизировать всю эту работу макросов(биснес макросов).</p><p>2. Вскоре мы поймем, что сопоставление с образцом(pattern-matching) облегчает жизнь.
Мы узнаем о <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN> и его ближайшем родственнике <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN>. Мы обнаружим, что можем запутаться, если захотим
разобрать переменные шаблона, прежде чем вставлять их обратно в шаблон, и узнаем как это сделать.
</p><p>3. На данный момент мы сможем написать много полезных макросов. Но что, если мы
хотим написать, когда то популярный анафорический макрос если(anaphoric if), с
"магической переменной"?  Оказывается мы были защищены от ошибок определенного рода.
Когда мы хотим их сделать специально(захватить переменную, как это происходит в 
при написании анафорического макроса), мы используем синтаксический параметр 
(syntax parameter). [Есть и другие, более старые способы сделать это. Мы не будем
их здесь рассматривать. Мы также не будем тратить много времени на пропаганду
 "гигиены(hygiene)"—<WBR>просто оговорим, что придерживаться её, это хорошо.]</p>
<p>4. Наконец мы поймем, что наши макросы могут быть умнее, если их использовать
ошибочно. Обычные функции Racket могут иметь контракты(contracts) и типы(types).
Они перехватывают ошибки использования и предоставляют ясные, полезные сообщения
об ошибках. Было бы здорово, если бы что то подобное для макросов. И это у них есть! Одним из последних усовершенствований макросов Racket является 
<SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>.</p>
<H3>3<TT>&nbsp;</TT><A name="(part._.Transform_)"></A>Преобразуй!</H3><p><TABLE cellspacing="0" cellpadding="0">  <TBODY>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">YOU ARE 
      INSIDE A ROOM.</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">THERE ARE 
      KEYS ON THE GROUND.</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">THERE IS A 
      SHINY BRASS LAMP NEARBY.</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN 
  class="stt"></SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">IF YOU GO THE 
      WRONG WAY, YOU WILL BECOME</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">HOPELESSLY 
      LOST AND CONFUSED.</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN 
  class="stt"></SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">&gt; pick up 
      the keys</SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN 
  class="stt"></SPAN></p>
</TD></tr>  <TR>    <TD><p><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="stt">YOU HAVE A 
      SYNTAX TRANSFORMER</SPAN></p>
</TD></tr></TBODY></TABLE><p></p><H4>3.1<TT>&nbsp;</TT><A name="(part._.What_is_a_syntax_transformer_)"></A> Что 
такое синтаксический преобразователь?</H4>
<p>Синтаксический преобразователь не является одним из トランスフォーマ <A href="http://en.wikipedia.org/wiki/Transformers">роботов-трансформеров</A>.</p><p>Вместо этого это простая функция. Функция принимает синтаксис(syntax) и возвращает
синтаксис(syntax). Он(преобразователь) преобразует синтаксис.</p>
<p>Вот функция преобразователь, которая игнорирует свой входной синтаксис и 
всегда выдает синтаксис для строкового литерала:</p>
<BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Эти примеры педполагают <SPAN class="RktInBG"><SPAN 
      class="hspace"></SPAN><SPAN class="RktIn">#lang racket</SPAN><SPAN class="hspace"></SPAN></SPAN>. 
      Если вы хотите попробовать их используя <SPAN class="RktInBG"><SPAN 
      class="hspace"></SPAN><SPAN class="RktIn">#lang racket/base</SPAN><SPAN 
      class="hspace"></SPAN></SPAN>, вам потребуется <SPAN class="RktInBG"><SPAN 
      class="hspace"></SPAN><SPAN class="RktIn">(require (for-syntax 
      racket/base))</SPAN><SPAN 
  class="hspace"></SPAN></SPAN>.</p>
</BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" data-pltdoc="x">syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"I am foo"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Используем его:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"I am foo"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Когда мы используем <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" 
data-pltdoc="x">define-syntax</A></SPAN>, мы создаем <SPAN 
style="font-style: italic;">привязку(binding)</SPAN> к преобразователю. Она говорит
компилятору Racket, 
"Всякий раз, когда ты столкнешься с фрагментом синтаксиса, начинающимся с <SPAN 
class="RktSym">foo</SPAN>, передай его моей функции перобразователю, и замени
его синтаксисом, который я тебе верну." Таким образом Racket передаст, всё что
похоже на <SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN> нашей функции и мы сможем
вернуть новый синтаксис для использования вместо него. Очень похоже на операцию
поиска и замены(search-and-replace).</p>
<p>Может быть вы знаете, что обычный способ определения фунции в Racket:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
  data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym">f</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
  data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>является сокращением для:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
  data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym">f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" 
  data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym">x</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
  data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN 
  class="RktPn">)</SPAN></p></BLOCKQUOTE><p>Это сокращение позволяет избежать ввода <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" 
data-pltdoc="x">lambda</A></SPAN> и нескольких скобок.</p><p>А это аналогичное сокращение для <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" 
data-pltdoc="x">define-syntax</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">also-foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" data-pltdoc="x">syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"I am also foo"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">also-foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"I am also foo"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Все что нужно помнить об этом, это простые сокращения. Мы все так же определяем
функцию преобразователь, которая принимает синтаксис и возвращает синтаксис. 
Всё, что мы делаем с макросами, будет построено на основе этой основной идеи. 
Это не волшебство.</p>
<p>Говоря о сокращениях, есть также сокращение для <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN>, которым является <SPAN class="RktInBG"><SPAN class="hspace"></SPAN><SPAN 
class="RktIn">#'</SPAN><SPAN class="hspace"></SPAN></SPAN>:</p>
<BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p><SPAN class="RktInBG"><SPAN class="hspace"></SPAN><SPAN 
      class="RktIn">#'</SPAN><SPAN class="hspace"></SPAN></SPAN> is short for  
      <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
      data-pltdoc="x">syntax</A></SPAN> much like <SPAN class="RktInBG"><SPAN 
      class="hspace"></SPAN><SPAN class="RktIn">'</SPAN><SPAN 
      class="hspace"></SPAN></SPAN> is short for <SPAN class="RktSym"><A class="RktStxLink" 
      href="https://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" 
      data-pltdoc="x">quote</A></SPAN>.</p>
</BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">quoted-foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktVal">"I am also foo, using #' instead of syntax"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">quoted-foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"I am also foo, using #' instead of syntax"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Теперь мы будем использовать сокращение <SPAN class="RktInBG"><SPAN class="hspace"></SPAN><SPAN class="RktIn">#'</SPAN><SPAN 
class="hspace"></SPAN></SPAN> вместо syntax.</p>
<p>Конечно, мы можем использовать синтаксис, который интереснее строкового литерала. 
Как насчет возврата <SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" 
data-pltdoc="x">displayln</A></SPAN><SPAN class="stt"> </SPAN><SPAN class="RktVal">"hi"</SPAN><SPAN 
class="RktPn">)</SPAN>?</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">say-hi</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"hi"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">say-hi</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktOut">hi</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Когда Racket расширяет нашу программу, он видит вхождение <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym">say-hi</SPAN><SPAN class="RktPn">)</SPAN>, и видит что для него
есть функция преобразования. Оны вызывает нашу функцию со старым синтаксисом, и
мы возвращаем новый синтаксис, который и используется для вычисления и запуска
нашей программы.</p><H4>3.2<TT>&nbsp;</TT><A name="(part._.What_s_the_input_)"></A>Какой вход?</H4><p>Наши примеры до сих пор игнорировали входной синтаксис и выводили некоторый
фиксированный синтаксис. Но обычно мы хотим преобразовать входной синтаксис во
что-то другое.</p><p>Давайте начнем с того, что внимаетльно посмотрим на то, что на самом деле
представляет собой вход - <SPAN style="font-style: italic;">это</SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">show-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._print%29%29" data-pltdoc="x">print</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">show-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">+</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">2</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktOut">#&lt;syntax:eval:10:0 (show-me (quote (+ 1 2)))&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._print%29%29" 
data-pltdoc="x">print</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN> показывает что передано
нашему преобразователю: это синтаксический объект.</p><p>Синтаксический объект состоит из нескольких вещей. Первая часть, это
 S-выражение, представляющее код, например такой как <SPAN class="RktVal">'</SPAN><SPAN 
class="RktVal">(</SPAN><SPAN class="RktVal">+</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktVal">1</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktVal">2</SPAN><SPAN 
class="RktVal">)</SPAN>.</p>
<p>Объект syntax в Racket  также украшен некоторой интересной информацией, такой как
исходный файл, номер строки и столбца. Наконец, в нем есть информация о лексиеческой
области видимости ( о которой вам пока не нужно беспокоиться, но которая станет важной 
позже.)</p>
<p>Существует множество функций для доступа к синтаксическому объекту. Давайте определим
части синтаксиса(syntax):</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" data-pltdoc="x">if</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktSym">stx</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#&lt;syntax:eval:11:0 (if x (list "true") #f)&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Теперь давайте использовать функции, которые обращаются к синтаксическому объекту.
Функция выдающая информацию об источнике синтаксиса:</p>
<BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
      href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-source%29%29" 
      data-pltdoc="x">syntax-source</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
      class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN> возвращает <SPAN 
      class="RktVal">'</SPAN><SPAN class="RktVal">eval</SPAN>, только из-за
того, что я генерирую эту документацию, используя интерпретатор(evaluator)
для запуска кода в  Scribble. Обычно это будет что-то вроде имени файла 
      "my-file.rkt".</p>
</BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-source%29%29" data-pltdoc="x">syntax-source</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'eval</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-line%29%29" data-pltdoc="x">syntax-line</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">11</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-column%29%29" data-pltdoc="x">syntax-column</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">0</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Более интересным является синтаксис самого "материала(stuff)". <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" 
data-pltdoc="x">syntax-&gt;datum</A></SPAN> полностью преобразует его в 
S-выражение:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'(if<SPAN class="stt"> </SPAN>x<SPAN class="stt"> </SPAN>(list<SPAN class="stt"> </SPAN>"true")<SPAN class="stt"> </SPAN>#f)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>В то время как <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" 
data-pltdoc="x">syntax-e</A></SPAN> спускается только на "один уровень вниз". Он может вернуть
список синтаксических объектов:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" data-pltdoc="x">syntax-e</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'(#&lt;syntax:eval:11:0 if&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 x&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 (list "true")&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 #f&gt;)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Каждый из этих синтаксических объектов может быть преобразован с помощью <SPAN class="RktSym"><A 
class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" 
data-pltdoc="x">syntax-e</A></SPAN>, а также рекурсивно—<WBR> что и делает <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" 
data-pltdoc="x">syntax-&gt;datum</A></SPAN>.</p>
<p>В большинстве случаев, <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" 
data-pltdoc="x">syntax-&gt;list</A></SPAN> дает тот же результат, что и <SPAN class="RktSym"><A 
class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" 
data-pltdoc="x">syntax-e</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'(#&lt;syntax:eval:11:0 if&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 x&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 (list "true")&gt;<SPAN class="stt"> </SPAN>#&lt;syntax:eval:11:0 #f&gt;)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>(Когда <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" 
data-pltdoc="x">syntax-e</A></SPAN> и <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" 
data-pltdoc="x">syntax-&gt;list</A></SPAN> будут отличаться? Давайте не будем сейчас отвлекаться от
намеченного курса.)</p><p>Когда мы хотим преобразовать синтаксис, мы обычно берем фрагменты, которые нам дали,
возможно меняем их поряедок, возможно менем некоторые фрагменты и часто вводим совершенно
новые фрагменты.</p><H4>3.3<TT>&nbsp;</TT><A 
name="(part._.Actually_transforming_the_input)"></A>Фактическое преобразование
входа</H4><p>Давайте напишем функцию преобразователь, которая переворачивает(reverses) синтаксис,
который ей был задан:</p>
<p><DIV class="SIntrapara"><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" 
      data-pltdoc="x">values</A></SPAN> в конце примера позволяет хорошо оценить результат.  
      Попробуйте <SPAN class="RktPn">(</SPAN><SPAN class="RktSym">reverse-me</SPAN><SPAN 
      class="stt"> </SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="stt"> 
      </SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="stt"> </SPAN><SPAN 
      class="RktVal">"i"</SPAN><SPAN class="RktPn">)</SPAN> чтобы увидеть, почему это
      удобно.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE></DIV><DIV class="SIntrapara"><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">reverse-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._reverse%29%29" data-pltdoc="x">reverse</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cdr%29%29" data-pltdoc="x">cdr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">reverse-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"i"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" data-pltdoc="x">values</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"i"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"am"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"backwards"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE></DIV><p></p><p>Понять Йоду мы можем. Отлично, но как это работает?</p><p>Вначале мы берем входной синтаксис и передаем его <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" 
data-pltdoc="x">syntax-&gt;datum</A></SPAN>. Он преобразует синтаксис в простой старый список:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">reverse-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"i"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" data-pltdoc="x">values</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'(reverse-me<SPAN class="stt"> </SPAN>"backwards"<SPAN class="stt"> </SPAN>"am"<SPAN class="stt"> </SPAN>"i"<SPAN class="stt"> </SPAN>values)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Используя <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cdr%29%29" 
data-pltdoc="x">cdr</A></SPAN> вырезаем первый элемент списка, <SPAN 
class="RktSym">reverse-me</SPAN>, оставив остаток: <SPAN 
class="RktPn">(</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="stt"> 
</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktVal">"i"</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" 
data-pltdoc="x">values</A></SPAN><SPAN class="RktPn">)</SPAN>. Передаем его в <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._reverse%29%29" 
data-pltdoc="x">reverse</A></SPAN> изменяющим его в <SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" 
data-pltdoc="x">values</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktVal">"i"</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktVal">"am"</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktVal">"backwards"</SPAN><SPAN class="RktPn">)</SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._reverse%29%29" data-pltdoc="x">reverse</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cdr%29%29" data-pltdoc="x">cdr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">reverse-me</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"i"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">values</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'(values<SPAN class="stt"> </SPAN>"i"<SPAN class="stt"> </SPAN>"am"<SPAN class="stt"> </SPAN>"backwards")</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Наконец мы используем <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN> для преобразования этого списка обратно в <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">values</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"i"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#&lt;syntax (values "i" "am" "backwards")&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Вот что наша функция преобразователь возвращает компилятору Racket, и<SPAN style="font-style: italic;">этот</SPAN> синтаксис вычисляется:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" data-pltdoc="x">values</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"i"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"am"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"backwards"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"i"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"am"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"backwards"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Первый аргумент <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
      data-pltdoc="x">datum-&gt;syntax</A></SPAN> содержит информацию лексического
      контекста, которую мы хотим связать с  <SPAN class="RktSym"><A 
      class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
      data-pltdoc="x">syntax</A></SPAN> выдаваемым(возвращаемым) преобразователем. Если
      первый аргумент установлен в <SPAN class="RktVal">#f</SPAN> лексический контекст
      ассоциирован не будет.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><H4>3.4<TT>&nbsp;</TT><A name="(part._.Compile_time_vs__run_time)"></A>Время
компиляции против времени выполнения</H4>
<p><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktMeta"></SPAN></TD></tr><TR><TD><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pipeports.html#%28def._%28%28quote._~23~25kernel%29._make-pipe%29%29" data-pltdoc="x">make-pipe</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktCmt">;Ce</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktCmt">n'est</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktCmt">pas</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktCmt">le</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktCmt">temps</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktCmt">d'exécution</SPAN><SPAN class="RktMeta"></SPAN></TD></tr><TR><TD><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" data-pltdoc="x">#'</A></SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktMeta"></SPAN></TD></tr></TBODY></TABLE><p></p><p>Обычный код Racket запускается ... во время выполнения. Duh.</p><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Вместо "время компиляции против времени выполнения", вы можете описывать
       это как"фаза синтаксического анализа против фазы времени выполнения". 
  Разницы нет.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><p>Но преобразователь синтаксиса вызывается Racket как часть процесса 
разбора, расширения и компиляции нашей программы. Другими словами, наша
функция синтаксического преобразования вычисляется во время компиляции.</p><p>Этот аспект макросов позволяет вам делать вещи, которые просто невозможны в
обычном коде. Одним из классических примеров является что то вроде Racket формы, 
<SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" 
data-pltdoc="x">if</A></SPAN>:</p>
<p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" 
data-pltdoc="x">if</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">&lt;condition&gt;</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">&lt;true-expression&gt;</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym">&lt;false-expression&gt;</SPAN><SPAN 
class="RktPn">)</SPAN></p><p>Если бы мы реализовали <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" 
data-pltdoc="x">if</A></SPAN> как функцию, все ее аргументы были бы вычислены перед
тем как они бы были переданы в функцию.</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" data-pltdoc="x">cond</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" data-pltdoc="x">else</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Это похоже на работу. Тем не менее, как на счет этого:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE cellspacing="0" cellpadding="0"><TBODY><TR><TD><p><SPAN class="RktOut">true</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktOut">false</SPAN></p></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Один из ответов заключается в том, что функциональное программирование это
      хорошо, а побочные(сторонние) эффекты это плохо. Но избегать побочных эффектов
   не всегда практично.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><p>Уппс. Поскольку выражения имеют побочный эффект, очевидно, что они оба вычисляются.
И это может быть проблемой—<WBR> что если побочный эффект включает
удаление файла на диске? Вы бы не хотели <SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" 
data-pltdoc="x">if</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">user-wants-file-deleted?</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Filesystem.html#%28def._%28%28quote._~23~25kernel%29._delete-file%29%29" 
data-pltdoc="x">delete-file</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="stt"> 
</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" 
data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN 
class="RktPn">)</SPAN> удалить файл, даже когда <SPAN 
class="RktSym">user-wants-file-deleted?</SPAN> установлено в <SPAN 
class="RktVal">#f</SPAN>.</p>
<p>Так что это просто не может работать как обычная функция. Однако преобразователь
синтаксиса, может изменить синтаксис – переписать код – во время компиляции.  Части 
синтаксиса перемещаются, но фактически, они не вычисляются до времени выполнения.</p><p>Вот один из способов это сделать:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" data-pltdoc="x">cadr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._caddr%29%29" data-pltdoc="x">caddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" data-pltdoc="x">cadddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktOut">true</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">display-and-return</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktOut">false</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktRes">"false"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Это дало правильный ответ. Но как?  Давайте вытащим саму функцию преобразователь
и посмотрим, что она сделала. Мы начнем с примера некоторого входного синтаксиса:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktOut">#&lt;syntax:eval:32:0 (our-if-v2 #t "true" "false")&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>1. Мы берем исходный(оригинальный) синтаксис, и используем <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" 
data-pltdoc="x">syntax-&gt;list</A></SPAN> чтобы изменить его на <SPAN class="RktSym"><A 
class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" 
data-pltdoc="x">список</A></SPAN> синтаксических объектов:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktOut">(#&lt;syntax:eval:32:0 our-if-v2&gt; #&lt;syntax:eval:32:0 #t&gt; #&lt;syntax:eval:32:0 "true"&gt; #&lt;syntax:eval:32:0 "false"&gt;)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>2. Чтобы преобразовать его в Racket  форму <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" 
data-pltdoc="x">cond</A></SPAN>, нам нужно взять три интересующих фрагмента
—<WBR> условие, выражение вычисляющееся при истине, и выражение вычисляющееся при лжи—<WBR> из
списка, используя <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" 
data-pltdoc="x">cadr</A></SPAN>, <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._caddr%29%29" 
data-pltdoc="x">caddr</A></SPAN>, и <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" 
data-pltdoc="x">cadddr</A></SPAN> и разместить их в форме <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" 
data-pltdoc="x">cond</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" data-pltdoc="x">cadr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._caddr%29%29" data-pltdoc="x">caddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" data-pltdoc="x">cadddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>3. Наконец, мы изменяем это выражение на <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN> используя <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" data-pltdoc="x">cadr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._caddr%29%29" data-pltdoc="x">caddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" data-pltdoc="x">cadddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">#&lt;syntax (cond (#t "true") (else "false"))&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Так что это работает, но с использование <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" 
data-pltdoc="x">cadddr</A></SPAN> и т.д. для разбора списка является болезненным и подверженным
ошибкам. Может быть вы знаете функцию Racket <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" 
data-pltdoc="x">match</A></SPAN>? Её использование позволило бы нам
использовать сопоставление с образцом(pattern-matching).</p>
<BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Обратите внимание, что нас не волнует первый элемент в синтаксическом списке. Мы не
      принимали <SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
      href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" 
      data-pltdoc="x">car</A></SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">xs</SPAN><SPAN 
      class="RktPn">)</SPAN> в our-if-v2, и мы не использовали <SPAN class="RktSym">name</SPAN> 
      когда использовали сопоставление с образцом(pattern-matching). В общем, синтаксический
      преобразователь не беспокоиться о нем, потому что это имя привязки преобразователя. Другими
      словами, макрос обычно не заботится о своем собственном имени.
</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><p>Вместо:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" data-pltdoc="x">cadr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._caddr%29%29" data-pltdoc="x">caddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" data-pltdoc="x">cadddr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">xs</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Мы можем записать:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-match</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" data-pltdoc="x">match</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Отлично. Теперь давайте попробуем его использовать:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-match</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">match: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Упппс. Получаем жалобу, что <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" 
data-pltdoc="x">match</A></SPAN> не определено.</p>
<p>Наша функция преобразования работает во время компиляции, а не во время 
выполнения, А во время компиляции, для нас автоматически требуется только 
<SPAN class="RktSym">racket/base</SPAN> —<WBR>, а не полная <SPAN class="RktSym">racket</SPAN> система.</p><p>Все, кроме <SPAN class="RktSym">racket/base</SPAN>, мы должны требовать(require)
сами—<WBR>и требовать это для времени компиляции, используя форму<SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN> для <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN>.</p>
<p>В этом случае вместо использования обычного <SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">racket/match</SPAN><SPAN class="RktPn">)</SPAN>, нам надо использовать часть <SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">racket/match</SPAN><SPAN 
class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN>—<WBR> <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN> означающую, "для времени компиляции".</p><p>Итак, давайте попробуем это:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/match</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-match-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" data-pltdoc="x">match</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-match-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Ура!</p><H4>3.5<TT>&nbsp;</TT><A name="(part._begin-for-syntax)"></A><SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin-for-syntax%29%29" 
data-pltdoc="x">begin-for-syntax</A></SPAN></H4><p>Мы используем <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN> в выражении, требования загрузки  - <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN> модуля <SPAN class="RktSym">racket/match</SPAN> 
потому что нам нужно было использовать функцию <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" 
data-pltdoc="x">match</A></SPAN> во время компиляции.</p><p>Что, если мы хотим определить нашу собственную вспомогательную функцию, которая
будет использоваться макросом?  
Одним из способов сделать это - поместить её в другой модуль и потребовать загрузить
ее во время компиляции <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN> воспользовавшись <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN>, как мы это делали с модулем <SPAN class="RktSym">racket/match</SPAN> 
module.</p><p>Если в место этого мы хотим поместить эту вспомогательную функцию в тот же модуль,
мы не можем просто определить( 
<SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
data-pltdoc="x">define</A></SPAN>) его и использовать его—<WBR>определение будет
существовать во время выполнения, но нам нужно во время компиляции. Ответ заключается
в том, чтобы поместить определение вспомогательной функции(функций) внутрь <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin-for-syntax%29%29" 
data-pltdoc="x">begin-for-syntax</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin-for-syntax%29%29" data-pltdoc="x">begin-for-syntax</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">macro-using-my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>В простом случае, мы можем использовать <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-for-syntax%29%29" 
data-pltdoc="x">define-for-syntax</A></SPAN>, которое сочетает <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin-for-syntax%29%29" 
data-pltdoc="x">begin-for-syntax</A></SPAN> и <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
data-pltdoc="x">define</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-for-syntax%29%29" data-pltdoc="x">define-for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">macro-using-my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">my-helper-function</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">....</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Для обзора:</p><UL>  <LI><p>Синтаксические преобразователи работают во время компиляции, а не во время
  выполнения. Хорошая новость заключается в том, что мы можем делать такие вещи,
  как реорганизация(перестановка) фрагментов  синтаксиса без их вычисления. Мы можем
  реализовать формы, такие как <SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" 
  data-pltdoc="x">if</A></SPAN> которые просто не могут работать должным образом как
  функции времени выполнения.</p></LI>  <LI><p>Еще одна хорошая новость заключается в том, что не существует какого-то особенного,
  странного языка для написания синтаксических преобразователей. Мы можем написать эти
  функци используя язык Racket, который мы уже знаем и любим.</p></LI>  <LI><p>Плохая новость заключается в том, что мы это знакомство позволяет легко забыть,
  что мы не работаем во время выполнения. Иногда это важно помнить.</p>

  <UL>
    <LI><p>Например, только <SPAN class="RktSym">racket/base</SPAN> является для нас 
    автоматически  затребуемым(required). Если нам нужны другие модули, мы должны
    затребовать их, и делать это 
    so <SPAN style="font-style: italic;">во время компиляции</SPAN> используя <SPAN 
    class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
    data-pltdoc="x">for-syntax</A></SPAN>.</p>
</LI>    <LI><p>Точно также, если мы хотим определить вспомогательные функции в том же файле/модуле,
    что и макросы, которые их используют, нам нужно заключить их определения в 
    форму <SPAN 
    class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin-for-syntax%29%29" 
    data-pltdoc="x">begin-for-syntax</A></SPAN>. Это делает их доступными во время
    компиляции.</p>
</LI></UL></LI></UL><H3>4<TT>&nbsp;</TT><A name="(part._pattern-matching)"></A>Сопоставление с образцом: 
syntax-case и syntax-rules</H3>
<p>Наиболее полезные синтаксические преобразователи работают принимая некоторый
входной синтаксис и преобразуют(переставляют) его части во что-то еще.  Как мы
видели, это возможно, но утомительно делать используя методы доступа к спискам,
такие как <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadddr%29%29" 
data-pltdoc="x">cadddr</A></SPAN>. Более удобно и менее подверженно ошибкам использовать
 <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" 
data-pltdoc="x">match</A></SPAN> сопоставление с образцом(pattern-matching).</p>
<BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Исторически, сложилось так, что сопоставление с образцом с помощью <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
      data-pltdoc="x">syntax-case</A></SPAN> и <SPAN class="RktSym"><A class="RktStxLink" 
      href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-rules%29%29" 
      data-pltdoc="x">syntax-rules</A></SPAN> использовались первыми. <SPAN 
      class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" 
      data-pltdoc="x">match</A></SPAN> был добавлен в Racket 
  позже.</p></BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE><p>Оказывается, что сопоставление с образцом было одним из первых улучшений, которые
были добавлены в систему макросов Racket. Оно называется <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>, и имеет сокращение для простых ситуаций называемое <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN>.</p><p>Вспомните наш предыдущий пример:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/match</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-match-v2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" data-pltdoc="x">match</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">`</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">cond</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktVal">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">[</SPAN><SPAN class="RktVal">else</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">,</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktVal">]</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Теперь посмотрите, как это выглядит с использованием <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-syntax-case</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" data-pltdoc="x">cond</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" data-pltdoc="x">else</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-syntax-case</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Довольно похоже, да? Часть соопоставления с образцом выглядит почти точно также.
Способ, которым мы указываем новый синтаксис, проще. Нам не нужно делать квази-
цитировани и децитирование. Нам не нужно использовать <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN>. Вместо этого, мы предоставляем "шаблон(template)", 
который использует переменные из образца.</p>
<p>Для простых случаев сопоставления с образцом существует сокращение, которое расширяется
до <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>. Оно называется <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" data-pltdoc="x">define-syntax-rule</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-syntax-rule</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" data-pltdoc="x">cond</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" data-pltdoc="x">else</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-if-using-syntax-rule</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"true"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"false"</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"true"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Здесь все что нужно для <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN>. Поскольку оно очень простое, <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN> является первым, чему учат людей о макросах.
Но эта простота обманчива. Оно(определение) похоже на определение обычной функции
времени выполнения—<WBR> но это не так! Оно работает во время компиляции, а не 
во время выполнения. Хуже того, в тот момент, когда вы захотите сделать больше, чем может
определить <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN>, вы можете упасть с обрыва на
некую сложную и запутанную территорию. Надеюсь, что поскольку мы начали с базового
синтаксического преобразователя и разработали его, у нас не возникнет этой проблемы.
Мы можем ценить <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" 
data-pltdoc="x">define-syntax-rule</A></SPAN> как удобное сокращение, но и не смущаться из-за
того, что оно является простым сокращением.</p><p>Большинство материалов, которые я нашел для изучения макросов, включая Racket <SPAN 
style="font-style: italic;">Guide</SPAN>, очень хорошо объясняют,  <A href="http://docs.racket-lang.org/guide/pattern-macros.html">как работают образцы и шаблоны</A>. Так что я не буду
объяснять это здесь.</p><p>Иногда, нам нужно сделать шаг за пределы образца и шаблона. Давайте посмотрим
на некоторые примеры, как мы можем запутаться и как это работает.</p>
<H4>4.1<TT>&nbsp;</TT><A 
name="(part._.Pattern_variable_vs__template---fight_)"></A>Переменные образца(Pattern variable)
против шаблона(template)—<WBR> сражение!</H4><p>Допустим мы хотим определить функцию, с написанным через дефис именем, a-b, но мы предоставляем
части  a и b отдельно. Racket макрос <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" 
data-pltdoc="x">struct</A></SPAN> делает нечто подобное этому, например: <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" 
data-pltdoc="x">struct</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">foo</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym">field1</SPAN><SPAN class="stt"> 
</SPAN><SPAN class="RktSym">field2</SPAN><SPAN class="RktPn">)</SPAN><SPAN 
class="RktPn">)</SPAN> автоматически определяет ряд функций, имена которых
являются вариациями имени <SPAN class="RktSym">foo</SPAN>—<WBR>такие как <SPAN 
class="RktSym">foo-field1</SPAN>, <SPAN class="RktSym">foo-field2</SPAN>, <SPAN 
class="RktSym">foo?</SPAN>, и так далее.</p><p>Итак, давайте представим, что мы делаем что-то подобное. Мы хотим преобразовать
синтаксис <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym">hyphen-define</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">a</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym">b</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN 
class="RktPn">)</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">body</SPAN><SPAN class="RktPn">)</SPAN> в синтаксис <SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
data-pltdoc="x">define</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym">a-b</SPAN><SPAN class="stt"> 
</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">body</SPAN><SPAN class="RktPn">)</SPAN>.</p><p>Неправильная первая попытка:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/wrong1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktErr">eval:47:0: a: pattern variable cannot be used outside of a</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr">template</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: a</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Мда. Мы понятия не имеем, что означает это сообщение об ошибке. Ну давайте
попробуем разобраться. "Шаблон(template)" на который ссылается сообщение об
ошибке это часть <SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
data-pltdoc="x">define</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="stt"> 
</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">body</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN>. <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" 
data-pltdoc="x">let</A></SPAN> не является часть этого шаблона. Она говори нам, что
мы не можем использовать <SPAN class="RktSym">a</SPAN> (или <SPAN class="RktSym">b</SPAN>) в 
форме <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" 
data-pltdoc="x">let</A></SPAN>.</p>
<p>Фактически, <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN> может иметь столько шаблонов, сколько вы хотите.
Очевидный, обязательный шаблон - это последнее выражение, обеспечивающее синтаксис вывода.
Но вы можете использовать <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN> (так же как <SPAN class="RktInBG"><SPAN class="hspace"></SPAN><SPAN 
class="RktIn">#'</SPAN><SPAN class="hspace"></SPAN></SPAN>) для переменной образца. Это создает
другой шаблон, хотя и не большой, шаблон "забавного размера(fun size)". 
Давайте попробуем это:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/wrong1.1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Ошибок больше нет—<WBR>отлично! Давайте попробуем его использовать:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/wrong1.1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">foo-bar: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Очевидно, наш макрос определяет функцию с некоторым именем, отличным от <SPAN 
class="RktSym">foo-bar</SPAN>. Мда.</p>
<p><DIV class="SIntrapara">Именно здесь пошаговый макрорасширитель(Macro Stepper) DrRacket 
является неоценимым. </DIV>
<DIV class="SIntrapara"><BLOCKQUOTE class="refpara">  <BLOCKQUOTE class="refcolumn">    <BLOCKQUOTE class="refcontent"><p>Даже если вы предпочитаете в основном использовать Emacs, в этой ситуации определенно
стоит использовать DrRacket ради его Macro Stepper(расширителя макросов).</p>
</BLOCKQUOTE></BLOCKQUOTE></BLOCKQUOTE></DIV><p></p><p><IMG width="598" height="564" alt="" src="fear-of-macros_files/macro-stepper.png"></p><p>Расширитель макросов(Macro Stepper) говорит, что использование нашего макроса:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN 
  class="RktSym">hyphen-define/wrong1.1</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN 
  class="RktPn">)</SPAN></p></BLOCKQUOTE><p>расширяется в:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
  data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>Что ж, это объясняет наш результат. Вместо того чтобы расшириться
в:</p>
<BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
  data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>Наш шаблон использует символ <SPAN class="RktSym">name</SPAN>, а мы хотели
использовать его значение, такое как <SPAN class="RktSym">foo-bar</SPAN> в этом
использовании нашего макроса.</p><p>Есть ли что-то, что ведет себя подобно этому—<WBR>где использование переменной
в шаблоне дает ее значение? Да: Это переменная образца!. Наш образец не 
включает <SPAN class="RktSym">name</SPAN> потому что мы не ожидаем его в исходном
синтаксисе—<WBR>на самом деле весь смысл этого макроса заключается в его создании. 
Так что <SPAN class="RktSym">name</SPAN> не может быть в основном образце. 
Ну хорошо—<WBR>тогда давайте сделаем <SPAN style="font-style: italic;">дополнительный</SPAN> 
образец. Мы можем сделать его используя, вложенный <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/wrong1.2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Выглядит странно? Давайте сделаем глубокий вдох. Обычно наша функция преобразователя
задает синтаксис Racket, и мы передаем этот синтаксис в <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>.  Но мы также можем создать собственный синтаксис
на лету, и передать <SPAN style="font-style: italic;">его</SPAN> в <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>. Это всё, что мы делаем здесь. Целое выражение 
<SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN> это синтаксис, 
который мы создаем на лету. Мы можем передать его в <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>, и сопоставить его используя переменную образца
с именем <SPAN class="RktSym">name</SPAN>. Вуаля, у нас есть новая переменная образца. 
Мы можем использовать её в шаблоне, и её значение переходит в шаблон.</p><p>У нас может быть еще одна—<WBR>только одна, я обещаю!—<WBR>небольшая проблема.
 Давайте попробуем использовать нашу новую версию:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/wrong1.2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">foo-bar: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Hmm. <SPAN class="RktSym">foo-bar</SPAN> до сих пор <SPAN 
style="font-style: italic;">still</SPAN> не определен! Вернмеся в пошаговый
расширитель макросов(Macro Stepper). Сейчас он говорит что мы расширяемся в:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" 
  data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN 
  class="RktSym">|#&lt;syntax:11:24foo&gt;-#&lt;syntax:11:28 
  bar&gt;|</SPAN><SPAN class="RktPn">)</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN 
  class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>Да, правильно: <SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN> и <SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN> являются объектами
синтаксиса. Следовательно</p>
<BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
  href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" 
  data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN 
  class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" 
  data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN 
  class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>является печатной формой обоих синтксических объектов, соединенных дефисом:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktSym">|#&lt;syntax:11:24foo&gt;-#&lt;syntax:11:28 
  bar&gt;|</SPAN></p>
</BLOCKQUOTE><p>Вместо этого мы хотим получить данные(datum) в синтаксических объектах, таких как
символы <SPAN class="RktSym">foo</SPAN> и <SPAN class="RktSym">bar</SPAN>. Которые мы получаем
с помощью <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" 
data-pltdoc="x">syntax-&gt;datum</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#t</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>И теперь это работает!</p><p>Далее, несколько коротких команд.</p><H5>4.1.1<TT>&nbsp;</TT><A name="(part._with-syntax)"></A><SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN></H5><p>Вместо дополнительног, вложенного <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>, мы могли бы использовать <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN><SPAN class="refelem"><SPAN class="refcolumn"><SPAN 
class="refcontent">Другое имя для <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN> могло бы быть, "с новой переменной образца".
</SPAN></SPAN></SPAN>. Она переставляет(реорганизует) <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN> так, чтобы он выглядел больше как оператор <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" 
data-pltdoc="x">let</A></SPAN> —<WBR>вначале имя(name), затем значение(value). 
Также он более удобен если нам необходмо определить больше чем одну переменную
образца.</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" data-pltdoc="x">format</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#t</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Опять же, <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN> это просто перестроенный <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN style="font-style: italic;">&lt;syntax&gt;</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN style="font-weight: bold;">&lt;pattern&gt;</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">&lt;body&gt;</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN style="font-weight: bold;">&lt;pattern&gt;</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN style="font-style: italic;">&lt;syntax&gt;</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">&lt;body&gt;</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Используете ли вы дополнительный <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN> или используете <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN>, в любом случае вы просто определяете дополнительные переменные
образца. Не позволяйте терминологии и структуре делать эти действия загадкой.</p>
<H5>4.1.2<TT>&nbsp;</TT><A name="(part._with-syntax_)"></A><SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28form._%28%28lib._racket%2Fsyntax..rkt%29._with-syntax%2A%29%29" 
data-pltdoc="x">with-syntax*</A></SPAN></H5><p>Мы знаем, что <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" 
data-pltdoc="x">let</A></SPAN> не позволяет нам использовать привязу в следующей за ней
привязке:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktErr">a: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Вместо этого, мы можем вкладывать <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" 
data-pltdoc="x">let</A></SPAN>s:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">0</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Или использовать сокращение для вложенных, <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" 
data-pltdoc="x">let*</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" data-pltdoc="x">let*</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">0</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Аналогично, вместо написания вложенных <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
data-pltdoc="x">with-syntax</A></SPAN>, мы можем использовать <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28form._%28%28lib._racket%2Fsyntax..rkt%29._with-syntax%2A%29%29" 
data-pltdoc="x">with-syntax*</A></SPAN>:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28form._%28%28lib._racket%2Fsyntax..rkt%29._with-syntax%2A%29%29" data-pltdoc="x">with-syntax*</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">c</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">c</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Одна проблема заключается в том, что <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28form._%28%28lib._racket%2Fsyntax..rkt%29._with-syntax%2A%29%29" 
data-pltdoc="x">with-syntax*</A></SPAN> не предоставляется <SPAN 
class="RktSym">racket/base</SPAN>. Мы должны использовать <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" 
data-pltdoc="x">require</A></SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" 
data-pltdoc="x">for-syntax</A></SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN 
class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN>. В противном случае мы можем получить
довольно странное сообщение об ошибке:</p><p><SPAN style="font-style: italic;"><SPAN class="stt">...: ellipses not allowed 
as an expression in: ...</SPAN></SPAN>.</p>
<H5>4.1.3<TT>&nbsp;</TT><A name="(part._format-id)"></A><SPAN class="RktSym"><A 
class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN></H5><p>В <SPAN class="RktSym">racket/syntax</SPAN> 
есть служебная функция, называемая <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN>, которая позволяет нам форматировать имена идентификаторов более
кратко, чем мы делалаи выше:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok3</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define/ok3</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">baz</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">bar-baz</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#t</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Использовать <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN> удобно, поскольку он обрабатывает утомительное
преобразование из синтаксиса в строку и в символьные данные  ... и обратно.</p><p>Первый аргумент <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN>, <SPAN class="RktSym">lctx</SPAN>, это лексический
контекст, в котором будет создан идентификатор. Вы почти никогда не понадобиться
предоставлять <SPAN class="RktSym">stx</SPAN>—<WBR>общий синтаксис, который преобразует
макрос. Вместо этого вы хотите предоставить более специфичный кусочек синтаксиса, такой
как идентификатор, предоставляемый пользователем макросу. В этом примере, мы используем
<SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">a</SPAN>. Полученный идентификатор
будет иметь туже область, что и предоставленный пользователем. Скорее всего, он будет
вести себя так, как ожидает пользователь, особенно когда наш макрос состоит из
других макросов.</p>
<H5>4.1.4<TT>&nbsp;</TT><A name="(part._.Another_example)"></A>Другой
пример</H5>
<p>Наконец, вот вариант, который принимает произвольное количество частей имени, которые должны
быть объединены дефисами:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/string</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define*</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">names</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name-stxs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">names</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" data-pltdoc="x">datum-&gt;syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" data-pltdoc="x">car</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">name-stxs</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._string-~3esymbol%29%29" data-pltdoc="x">string-&gt;symbol</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28lib._racket%2Fstring..rkt%29._string-join%29%29" data-pltdoc="x">string-join</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" data-pltdoc="x">for/list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">name-stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">name-stxs</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol-~3estring%29%29" data-pltdoc="x">symbol-&gt;string</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" data-pltdoc="x">syntax-e</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">name-stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">"-"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">args</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">body0</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">body</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hyphen-define*</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">bar</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">baz</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2A%29%29" data-pltdoc="x">*</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-bar-baz</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">50</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">100</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Также как когда мы использовали <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN>, при использовании <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN> мы осторожны с первым аргументом 
<SPAN class="RktSym">lctx</SPAN>. Мы хотим, чтобы создаваемый нами идентификатор использовал лексический
контекст идентификатор, предоставленного макросу пользователем. В этом случае идентификаторы
пользователя становятся <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym">names</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN> переменной шаблона. Мы 
изменяем это из одного <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN> в список <SPAN class="RktSym"><A class="RktValLink" 
href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" 
data-pltdoc="x">list</A></SPAN> синтаксисов (<SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN>). Первый элемент мы используем для лексического
контекста. Тогда, конечно, мы будем использовать все элементы для формирования разделяемого дефисами
идентификатора.</p>
<p>Для обзора:</p><UL>  <LI><p>Вы не можете использовать переменную образца вне шаблона. Но вы можете использовать 
  <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
  data-pltdoc="x">syntax</A></SPAN> или <SPAN class="RktInBG"><SPAN class="hspace"></SPAN><SPAN 
  class="RktIn">#'</SPAN><SPAN class="hspace"></SPAN></SPAN>  с переменной образца, чтобы создать
специальный шаблон "забавного размера(fun size)".</p></LI>  <LI><p>Если вы хотите использовать новые переменные образца для использования в шаблоне, <SPAN 
  class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" 
  data-pltdoc="x">with-syntax</A></SPAN> является вашим другом, потому что он позволяет создавать
новые переменные образца.</p>
</LI>  <LI><p>Обычно вам нужно использовать <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" 
  data-pltdoc="x">syntax-&gt;datum</A></SPAN>, чтобы получить внутри интересующее значение.</p>
</LI>  <LI><p><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
  data-pltdoc="x">format-id</A></SPAN> удобен для форматирования имен идентификаторов.</p>
</LI></UL><H4>4.2<TT>&nbsp;</TT><A name="(part._.Making_our_own_struct)"></A>Создание
собственной <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" 
data-pltdoc="x">struct</A></SPAN></H4><p>Давайте применим то, что мы только что узнали, к более реалистичному примеру.
Мы притворимся, что Racket еще не обладает умением создавать <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" 
data-pltdoc="x">struct</A></SPAN>. К счастью мы можем написать макрос, чтобы
обеспечить нашу собственную систему для определения и использования структур. Для
простоты, наша структура будет неизменяемой(immutable) (только для чтения) и не 
будет поддерживать наследования.</p><p>Учитывая объявление структуры, вроде:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktSym">name</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym">field1</SPAN><SPAN 
  class="hspace">&nbsp;</SPAN><SPAN class="RktSym">field2</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" 
  data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN 
  class="RktPn">)</SPAN></p></BLOCKQUOTE><p>Нам нужно определить несколько процедур:</p><UL>  <LI><p>Процедуру конструктора, именем которой является имя структуры. Мы представим
  структуры как вектор <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" 
  data-pltdoc="x">vector</A></SPAN>. Имя структуры  будет нулевым элементом. 
  Поля будут следующими элементами вектора.</p>
</LI>  <LI><p>Добавляется предикат, чьё имя является именем структуры с <SPAN class="stt">?</SPAN>.</p></LI>  <LI><p>Для каждого поля используются процедуры доступа, чтобы получить его значение. Они
  будут называться структура-поле(struct-field) (имя структуры, дефис, имя поля).
</p></LI></UL><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a?"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#`</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin%29%29" data-pltdoc="x">begin</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define a constructor.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" data-pltdoc="x">apply</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" data-pltdoc="x">vector</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" data-pltdoc="x">cons</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define a predicate.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" data-pltdoc="x">and</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector~3f%29%29" data-pltdoc="x">vector?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" data-pltdoc="x">eq?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-ref%29%29" data-pltdoc="x">vector-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define an accessor for each field.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#,@</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" data-pltdoc="x">for/list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">n</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-naturals%29%29" data-pltdoc="x">in-naturals</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">ix</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">n</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#`</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" data-pltdoc="x">error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a is not a ~a struct"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-ref%29%29" data-pltdoc="x">vector-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ix</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Test it out</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">rackunit</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">b</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">2</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">check-true</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo?</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">check-false</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo?</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">check-equal?</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">check-equal?</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">2</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">check-exn</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._exn~3afail~3f%29%29" data-pltdoc="x">exn:fail?</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo-a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"furble"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">The tests passed.</SPAN></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Next, what if someone tries to declare:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">format-id: contract violation</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">expected: (or/c string? symbol? identifier? keyword? char?</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr">number?)</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">given: #&lt;syntax:eval:83:0 "blah"&gt;</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Сообщение об ошибке не очень помогает. Это происходит из за <SPAN 
class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" 
data-pltdoc="x">format-id</A></SPAN>, который является частной деталью реализации
нашего макроса.</p>
<p>Возможно вы знаете, что предложение <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN> может принимать необязательное выражение "guard" или 
"fender".  Вместо</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/syntax/stxparse-specifying.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._pattern%29%29" 
  data-pltdoc="x">pattern</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym">template</SPAN><SPAN class="RktPn">]</SPAN></p>
</BLOCKQUOTE><p>оно может быть:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" 
  href="https://docs.racket-lang.org/syntax/stxparse-specifying.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._pattern%29%29" 
  data-pltdoc="x">pattern</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym">guard</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">template</SPAN><SPAN 
  class="RktPn">]</SPAN></p></BLOCKQUOTE><p>Давайте добавим выражение guard к нашему предложению:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Guard or "fender" expression:</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._for-each%29%29" data-pltdoc="x">for-each</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28lib._racket%2Fprivate%2Fstx..rkt%29._identifier~3f%29%29" data-pltdoc="x">identifier?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise-syntax-error%29%29" data-pltdoc="x">raise-syntax-error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"not an identifier"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" data-pltdoc="x">cons</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a?"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#`</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/begin.html#%28form._%28%28quote._~23~25kernel%29._begin%29%29" data-pltdoc="x">begin</A></SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define a constructor.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" data-pltdoc="x">apply</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" data-pltdoc="x">vector</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" data-pltdoc="x">cons</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" data-pltdoc="x">list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define a predicate.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" data-pltdoc="x">and</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector~3f%29%29" data-pltdoc="x">vector?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" data-pltdoc="x">eq?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-ref%29%29" data-pltdoc="x">vector-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Define an accessor for each field.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#,@</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" data-pltdoc="x">for/list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3elist%29%29" data-pltdoc="x">syntax-&gt;list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">fields</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" data-pltdoc="x">...</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">n</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-naturals%29%29" data-pltdoc="x">in-naturals</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a-~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._id%29%29" data-pltdoc="x">id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">ix</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">n</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#`</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">pred-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" data-pltdoc="x">error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">acc-id</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a is not a ~a struct"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">id</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-ref%29%29" data-pltdoc="x">vector-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">v</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ix</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Now the same misuse gives a better error message:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">our-struct</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"blah"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:86:0: our-struct: not an identifier</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: "blah"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: (our-struct "blah" ("blah" "blah"))</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Позже, мы увидем как <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN> облегчает проверку использования и предоставляет полезные
сообщения об ошибках.</p><H4>4.3<TT>&nbsp;</TT><A name="(part._hash..refs)"></A>Использование точечной нотации 
для поиска по вложеным хешам</H4>
<p>В предыдущих двух примерах использовался макрос для определения функций, имена
которых были созданы путем объединения идентификаторов, предоставленных макросу.
Этот пример делает противоположное: идентификатор, переданный макросу, разбивается
на части.</p>
<p>Если вы пишете программы для веб-сервисов, вы имеете дело с  JSON, которые
представлен в  Racket как <SPAN class="RktSym">jsexpr?</SPAN>. У JSON часто есть
словари, которые содержат другие словари. В <SPAN 
class="RktSym">jsexpr?</SPAN> они представлены вложенными хеш-таблицами <SPAN class="RktSym"><A 
class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hasheq%29%29" 
data-pltdoc="x">hasheq</A></SPAN>:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Nested </SPAN><SPAN class="RktCmt">‘</SPAN><SPAN class="RktCmt">hasheq</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt">s typical of a jsexpr:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hasheq%29%29" data-pltdoc="x">hasheq</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hasheq%29%29" data-pltdoc="x">hasheq</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hasheq%29%29" data-pltdoc="x">hasheq</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">c</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"value"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>В JavaScript вы можете использовать точечную запись:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktSym">foo</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3d%29%29" data-pltdoc="x">=</A></SPAN><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><SPAN class="RktSym">js.a.b.c</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktMeta"></SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>В Racket это не так удобно:</p><BLOCKQUOTE class="SCodeFlow"><p><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" 
  href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" 
  data-pltdoc="x">hash-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" 
  data-pltdoc="x">hash-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" 
  data-pltdoc="x">hash-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktSym">js</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">'</SPAN><SPAN class="RktVal">a</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">'</SPAN><SPAN class="RktVal">b</SPAN><SPAN 
  class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN 
  class="RktVal">'</SPAN><SPAN class="RktVal">c</SPAN><SPAN 
  class="RktPn">)</SPAN></p>
</BLOCKQUOTE><p>Мы можем написать вспомогательную функцию, чтобы сделать это немного
яснее:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">This helper function:</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/attaching-contracts-to-values.html#%28form._%28%28lib._racket%2Fcontract%2Fregion..rkt%29._define%2Fcontract%29%29" data-pltdoc="x">define/contract</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash-refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">h</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ks</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">def</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash~3f%29%29" data-pltdoc="x">hash?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._listof%29%29" data-pltdoc="x">listof</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" data-pltdoc="x">any/c</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28def._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%2Fc%29%29" data-pltdoc="x">any/c</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">. </SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%2A%29%29" data-pltdoc="x"><SPAN class="nobreak">-&gt;</SPAN>*</A></SPAN><SPAN class="RktPn"> .</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/data-structure-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fprivate%2Fmisc..rkt%29._any%29%29" data-pltdoc="x">any</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/exns.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._with-handlers%29%29" data-pltdoc="x">with-handlers</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._exn~3afail~3f%29%29" data-pltdoc="x">exn:fail?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Ffunction..rkt%29._const%29%29" data-pltdoc="x">const</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._cond%29%29" data-pltdoc="x">cond</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28quote._~23~25kernel%29._procedure~3f%29%29" data-pltdoc="x">procedure?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">def</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">def</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._else%29%29" data-pltdoc="x">else</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">def</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Ffold%29%29" data-pltdoc="x">for/fold</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">h</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">h</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">k</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-list%29%29" data-pltdoc="x">in-list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ks</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" data-pltdoc="x">hash-ref</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">h</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">k</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Lets us say:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash-refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">a</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">b</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">c</SPAN><SPAN class="RktVal">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"value"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Так-то лучше. Можем ли мы пойти еще дальше и использовать точечную нотацию, 
похожую на JavaScript?</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">This macro:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">If the optional </SPAN><SPAN class="RktCmt">‘</SPAN><SPAN class="RktCmt">default</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt"> is missing, use #f.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">default</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" data-pltdoc="x">let*</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">chain-str</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol-~3estring%29%29" data-pltdoc="x">symbol-&gt;string</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" data-pltdoc="x">for/list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._str%29%29" data-pltdoc="x">str</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-list%29%29" data-pltdoc="x">in-list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/regexp.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._regexp-split%29%29" data-pltdoc="x">regexp-split</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#rx"\\."</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain-str</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._str%29%29" data-pltdoc="x">str</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">hash-table</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" data-pltdoc="x">car</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">keys</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cdr%29%29" data-pltdoc="x">cdr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash-refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">hash-table</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">keys</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">default</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Gives us "sugar" to say this:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js.a.b.c</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"value"</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Try finding a key that doesn</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt">t exist:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js.blah</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">#f</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Try finding a key that doesn</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt">t exist, specifying the default:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js.blah</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">did-not-exist</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">'did-not-exist</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Оно работает!</p><p>Мы начали понимать, что наши макросы должны давать полезные сообщения при ошибочном
использовании. Давайте попробуем сделать это здесь.</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for-syntax%29%29" data-pltdoc="x">for-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/syntax</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define-syntax%29%29" data-pltdoc="x">define-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" data-pltdoc="x">syntax-case</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Check for no args at all</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise-syntax-error%29%29" data-pltdoc="x">raise-syntax-error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"Expected hash.key0[.key1 ...] [default]"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">If the optional </SPAN><SPAN class="RktCmt">‘</SPAN><SPAN class="RktCmt">default</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt"> is missing, use #f.</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" data-pltdoc="x">_</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">default</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28lib._racket%2Fprivate%2Fstx..rkt%29._identifier~3f%29%29" data-pltdoc="x">identifier?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise-syntax-error%29%29" data-pltdoc="x">raise-syntax-error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"Expected hash.key0[.key1 ...] [default]"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" data-pltdoc="x">let*</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">chain-str</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol-~3estring%29%29" data-pltdoc="x">symbol-&gt;string</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-~3edatum%29%29" data-pltdoc="x">syntax-&gt;datum</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" data-pltdoc="x">for/list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._str%29%29" data-pltdoc="x">str</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-list%29%29" data-pltdoc="x">in-list</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/regexp.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._regexp-split%29%29" data-pltdoc="x">regexp-split</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#rx"\\."</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">chain-str</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/syntax-util.html#%28def._%28%28lib._racket%2Fsyntax..rkt%29._format-id%29%29" data-pltdoc="x">format-id</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Library_Syntax_Classes_and_Literal_Sets.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._str%29%29" data-pltdoc="x">str</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">Check that we have at least hash.key</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" data-pltdoc="x">and</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3e~3d%29%29" data-pltdoc="x">&gt;=</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._length%29%29" data-pltdoc="x">length</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">2</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" data-pltdoc="x">not</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._eq~3f%29%29" data-pltdoc="x">eq?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" data-pltdoc="x">syntax-e</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cadr%29%29" data-pltdoc="x">cadr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">||</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise-syntax-error%29%29" data-pltdoc="x">raise-syntax-error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"Expected hash.key"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">chain</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._with-syntax%29%29" data-pltdoc="x">with-syntax</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">hash-table</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" data-pltdoc="x">car</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">keys</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cdr%29%29" data-pltdoc="x">cdr</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">ids</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash-refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">hash-table</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">keys</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">default</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">See if we catch each of the misuses</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:96:0: hash.refs: Expected hash.key0[.key1 ...]</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr">[default]</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: chain</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: (hash.refs)</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:98:0: hash.refs: Expected hash.key0[.key1 ...]</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr">[default]</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: 0</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: (hash.refs 0 #f)</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:99:0: hash.refs: Expected hash.key</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: js</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: (hash.refs js #f)</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash.refs</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">js.</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:100:0: hash.refs: Expected hash.key</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: js.</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: (hash.refs js. #f)</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Не так уж плохо. Конечно, версия с проверкой ошибок немного длиннее. Код проверки
ошибки, как правило скрывает логику, как и здесь. К счастью, мы скоро увидим, как
<SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN> может помочь смягчить это, во многом также,
как контракты в обычном Racket или типы в Typed Racket.</p>
<p>Вомзможно мы не уверены, что написание <SPAN class="RktPn">(</SPAN><SPAN 
class="RktSym">hash.refs</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktSym">js.a.b.c</SPAN><SPAN class="RktPn">)</SPAN> на самом деле яснее,
чем <SPAN class="RktPn">(</SPAN><SPAN class="RktSym">hash-refs</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktSym">js</SPAN><SPAN class="stt"> </SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">(</SPAN><SPAN class="RktVal">a</SPAN><SPAN 
class="stt"> </SPAN><SPAN class="RktVal">b</SPAN><SPAN class="stt"> </SPAN><SPAN 
class="RktVal">c</SPAN><SPAN class="RktVal">)</SPAN><SPAN 
class="RktPn">)</SPAN>. Может быть мы не будем использовать этот подход, но макросистема
Racket делает его возможным для выбора.</p><H3>5<TT>&nbsp;</TT><A name="(part._.Syntax_parameters)"></A>Синтаксические
параметры</H3>
<p>"Анафорический(значит ссылающийся на ранее упомянутое имя(или вычисление)) if" или "aif" это популярный
пример макроса. Вместо написания:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">tmp</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">big-long-calculation</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" data-pltdoc="x">if</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">tmp</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">tmp</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Вы могли бы записать:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">big-long-calculation</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Другими словами, когда условие истинно, автоматически создается его идентификатор
и устанавливается значение этого условия. Это должно быть легко:
</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" data-pltdoc="x">define-syntax-rule</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" data-pltdoc="x">if</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#t</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">it: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Подождите, почему? <SPAN class="RktSym">it</SPAN> не определено?</p><p>Оказывается, что все время мы были защищены от определенных ошибок в наших макросах.
Ошибка в том, что наш новый синтаксис вводит переменную, которая случайно(при создании
анафорического макроса - намеренно) конфликтует
с переменной в коде, окружающим наш макрос.</p>
<p>В разделе Racket <SPAN style="font-style: italic;">Reference</SPAN>, <A 
href="http://docs.racket-lang.org/reference/syntax-model.html#(part._transformer-model)">Transformer
 Bindings</A>, есть хорошее объяснение и пример. По сути, синтаксис имеет "метки(marks)" 
для сохранения лексической области. Они заставляют ваш макрос вести себя как обычная
функция с точки зрения лексического охвата.</p><p>Если обычная функция определяет переменную с именем <SPAN class="RktSym">x</SPAN>, 
она не будет конфликтовать с переменной именуемой <SPAN class="RktSym">x</SPAN> во
внешней области видимости:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"outer"</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"inner"</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" data-pltdoc="x">printf</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"The inner `x' is ~s\n"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._printf%29%29" data-pltdoc="x">printf</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"The outer `x' is ~s\n"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE cellspacing="0" cellpadding="0"><TBODY><TR><TD><p><SPAN class="RktOut">The inner `x' is "inner"</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktOut">The outer `x' is "outer"</SPAN></p></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Когда наши макросы учитывают лексическую область видимости(охвата), проще написать
надежные макросы, которые ведут себя предсказуемо.</p>
<p>Так что это замечательное поведение по умолчанию. Но иногда мы хотим ввести 
магическую переменную специально—<WBR>например, как  <SPAN class="RktSym">it</SPAN> в <SPAN 
class="RktSym">aif</SPAN>.</p><p>Есть плохой способ сделать это и хороший способ.</p><p>Плохой способ - использвать <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._datum-~3esyntax%29%29" 
data-pltdoc="x">datum-&gt;syntax</A></SPAN>, который сложно использовать правильно. 
<SPAN class="refelem"><SPAN class="refcolumn"><SPAN class="refcontent">См. <A 
href="http://www.schemeworkshop.org/2011/papers/Barzilay2011.pdf">Keeping it 
Clean with Syntax Parameters (PDF)</A>.</SPAN></SPAN></SPAN></p><p>Хороший способ - использовать синтаксический параметр, используя <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._define-syntax-parameter%29%29" 
data-pltdoc="x">define-syntax-parameter</A></SPAN> и <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._syntax-parameterize%29%29" 
data-pltdoc="x">syntax-parameterize</A></SPAN>. Вы, вероятно, знакомы с обычными параметрами
в Racket:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">current-foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/parameters.html#%28def._%28%28quote._~23~25kernel%29._make-parameter%29%29" data-pltdoc="x">make-parameter</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"some default value"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">current-foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"some default value"</SPAN></p></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/parameters.html#%28form._%28%28lib._racket%2Fprivate%2Fmore-scheme..rkt%29._parameterize%29%29" data-pltdoc="x">parameterize</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">current-foo</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"I have a new value, for now"</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">current-foo</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">"I have a new value, for now"</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">current-foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">"some default value"</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Это обычный(нормальный) параметр. Вариант синтаксиса работает аналогично.
Идея в том, что мы определим <SPAN class="RktSym">it</SPAN> означающим по умолчанию
ошибку. Только внутри нашего <SPAN class="RktSym">aif</SPAN> он будет иметь 
выразительное значение:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/stxparam</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._define-syntax-parameter%29%29" data-pltdoc="x">define-syntax-parameter</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._raise-syntax-error%29%29" data-pltdoc="x">raise-syntax-error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxops.html#%28def._%28%28quote._~23~25kernel%29._syntax-e%29%29" data-pltdoc="x">syntax-e</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">stx</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"can only be used inside aif"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" data-pltdoc="x">define-syntax-rule</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">tmp</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">condition</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" data-pltdoc="x">if</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">tmp</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._syntax-parameterize%29%29" data-pltdoc="x">syntax-parameterize</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxtrans.html#%28def._%28%28quote._~23~25kernel%29._make-rename-transformer%29%29" data-pltdoc="x">make-rename-transformer</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktRdr">#'</SPAN><SPAN class="RktSym">tmp</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">true-expr</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">false-expr</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">10</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktOut">10</SPAN></p></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">aif</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">#f</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/void.html#%28def._%28%28quote._~23~25kernel%29._void%29%29" data-pltdoc="x">void</A></SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Внутри <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._syntax-parameterize%29%29" 
data-pltdoc="x">syntax-parameterize</A></SPAN>, <SPAN class="RktSym">it</SPAN> 
действует как псевдоним для <SPAN class="RktSym">tmp</SPAN>. Поведение псевдонима создается<SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/stxtrans.html#%28def._%28%28quote._~23~25kernel%29._make-rename-transformer%29%29" 
data-pltdoc="x">make-rename-transformer</A></SPAN>.</p>
<p>Если мы попытаемся использовать <SPAN class="RktSym">it</SPAN> вне <SPAN class="RktSym">aif</SPAN> 
формы и <SPAN class="RktSym">it</SPAN> не будет определен, мы получим ошибку, как мы и хотели:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._displayln%29%29" data-pltdoc="x">displayln</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">it: can only be used inside aif</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Но если мы все еще можем определить <SPAN class="RktSym">it</SPAN> как обычную переменную
при определении локального контекста, подобно:</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">10</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><p><SPAN class="RktRes">10</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>или:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">10</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktSym">it</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">foo</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">10</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Для более глубокого освоения, см <A href="http://www.schemeworkshop.org/2011/papers/Barzilay2011.pdf">Keeping 
it Clean with Syntax Parameters</A>.</p>
<H3>6<TT>&nbsp;</TT><A 
name="(part._.What_s_the_point_of_splicing-let_)"></A>Какой смысл в  <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/splicing.html#%28form._%28%28lib._racket%2Fsplicing..rkt%29._splicing-let%29%29" 
data-pltdoc="x">splicing-let</A></SPAN>?</H3>
<p>Я долго изучал <SPAN class="RktSym">racket/splicing</SPAN>. 
Что он делает? Зачем мне его использовать? Почему в разеде Macros на него есть 
ссылка?</p><p>Шаг первый, <SPAN class="strike">пробить дыру в черном ящике</SPAN> демифилогизировать его.
Например, используя <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/splicing.html#%28form._%28%28lib._racket%2Fsplicing..rkt%29._splicing-let%29%29" 
data-pltdoc="x">splicing-let</A></SPAN> вот так:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/splicing</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/splicing.html#%28form._%28%28lib._racket%2Fsplicing..rkt%29._splicing-let%29%29" data-pltdoc="x">splicing-let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">get-x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">get-x is visible out here:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">get-x</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">0</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">but x is not:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktSym">x</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">x: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>эквивалентно:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">get-y</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">y</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">y</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">get-y is visible out here:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">get-y</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktRes">0</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">but y is not:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktSym">y</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">y: undefined;</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr">cannot reference an identifier before its definition</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in module: 'program</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Это классическая идиома Lisp/Scheme/Racket, которую иногда назвают "let over 
lambda". <SPAN class="refelem"><SPAN class="refcolumn"><SPAN 
class="refcontent"> <A href="http://people.csail.mit.edu/gregs/ll1-discuss-archive-html/msg03277.html">Коан(повествование)</A>  о замыканиях и объектах.</SPAN></SPAN></SPAN> Замыкание скрывает <SPAN class="RktSym">y</SPAN>, 
к которому можно получить доступ только через <SPAN class="RktSym">get-y</SPAN>.</p>
<p>Так почему же мы заботимся о сращивании(splicing) форм? Они могут быть более
краткими, особенно когда есть несколько форм тела(body):</p>
<BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" data-pltdoc="x">require</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">racket/splicing</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/splicing.html#%28form._%28%28lib._racket%2Fsplicing..rkt%29._splicing-let%29%29" data-pltdoc="x">splicing-let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">inc</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" data-pltdoc="x">set!</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" data-pltdoc="x">+</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">dec</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" data-pltdoc="x">set!</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" data-pltdoc="x"><SPAN class="nobreak">-</SPAN></A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">get</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Вариация со сращиванием(splicing) удобнее обычно используемой формы:</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28quote._~23~25kernel%29._define-values%29%29" data-pltdoc="x">define-values</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">inc</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">dec</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">get</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" data-pltdoc="x">let</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">[</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">]</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/values.html#%28def._%28%28quote._~23~25kernel%29._values%29%29" data-pltdoc="x">values</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">inc</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" data-pltdoc="x">set!</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._%2B%29%29" data-pltdoc="x">+</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">dec</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" data-pltdoc="x">set!</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" data-pltdoc="x"><SPAN class="nobreak">-</SPAN></A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">1</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" data-pltdoc="x">lambda</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">get</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktSym">x</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR></TBODY></TABLE></BLOCKQUOTE><p>Когда есть много форм тела(body)—<WBR>и мы генерируем их в макросе
—<WBR>вариации использущие сращивание(splicing)  могут быть намного проще.
</p><H3>7<TT>&nbsp;</TT><A name="(part._.Robust_macros__syntax-parse)"></A>Надежные 
макросы: syntax-parse</H3>
<p>Функции могут быть использоваться ошибочно. Как и макросы.</p><H4>7.1<TT>&nbsp;</TT><A 
name="(part._.Error-handling_strategies_for_functions)"></A>Стратегии обработки
ошибок для функций</H4><p>С добрыми старыми функциями у нас есть несколько вариантов, как справиться
с неправильным использованием.</p>
<p>1. Не проверять ничего.</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" data-pltdoc="x">string-append</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">" snazzy suffix"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">User of the function:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">string-append: contract violation</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">expected: string?</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">given: 0</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">argument position: 1st</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">other arguments...:</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">" snazzy suffix"</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">I guess I goofed, but </SPAN><SPAN class="RktCmt">–</SPAN><SPAN class="RktCmt"> what is this "string-append" of which you</SPAN></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">speak??</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Проблема в том, что полученное сообщение об ошибке будет сбивать с толку.
Наш пользователь думает, что он неправильно вызывает 
<SPAN class="RktSym">misuse</SPAN>, но он получает сообщение
об ошибке от <SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" 
data-pltdoc="x">string-append</A></SPAN>.  В этом простом примере, пользователи
вероятно могут догадаться, что происходит, но в большистве случаев они
этого не сделают.</p><p>2. Написать некоторый код обработки ошибок.</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" data-pltdoc="x">unless</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" data-pltdoc="x">string?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" data-pltdoc="x">error</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">'</SPAN><SPAN class="RktVal">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">"expected a string, but got ~a"</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" data-pltdoc="x">string-append</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">" snazzy suffix"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">User of the function:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">misuse: expected a string, but got 0</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">I goofed, and understand why! It</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt">s a shame the writer of the</SPAN></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">function had to work so hard to tell me.</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>К сожалению, код обработки ошибок имеет тенденцию нарушать и/или затруднять
определение функции. Кроме того, сообщение об ошибке хорошо, но не отлично. Для
его получения потребуется еще больше кода обработки ошибки.</p><p>3. Использование контракта.</p><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/attaching-contracts-to-values.html#%28form._%28%28lib._racket%2Fcontract%2Fregion..rkt%29._define%2Fcontract%29%29" data-pltdoc="x">define/contract</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" data-pltdoc="x">string?</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">. </SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" data-pltdoc="x"><SPAN class="nobreak">-&gt;</SPAN></A></SPAN><SPAN class="RktPn"> .</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string~3f%29%29" data-pltdoc="x">string?</A></SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" data-pltdoc="x">string-append</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">" snazzy suffix"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">User of the function:</SPAN></TD></tr><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">misuse: contract violation</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">expected: string?</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">given: 0</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: the 1st argument of</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">(-&gt; string? string?)</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">contract from: (function misuse)</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">blaming: program</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">(assuming the contract is correct)</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">at: eval:131.0</SPAN></p></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">I goofed, and understand why! I</SPAN><SPAN class="RktCmt">'</SPAN><SPAN class="RktCmt">m happier, and I hear the writer of</SPAN></TD></tr><TR><TD><SPAN class="RktCmt">;</SPAN><SPAN class="RktCmt">&nbsp;</SPAN><SPAN class="RktCmt">the function is happier, too.</SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE><p>Это лучший из обоих миров.</p><p>Контракт(contract) прост и лаконичен. Еще лучше, он декларативен. Мы говори,
что хотим, а не как.</p>
<p>С другой стороны, пользователь нашей функции получает очень подробное
сообщение об ошибке. Плюс, сообщение в стандартном, знакомом формате.</p>
<p>4. Использовать типизированный(Typed) Racket.</p><p><DIV class="SIntrapara"><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><A class="RktModLink" href="https://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" data-pltdoc="x"><SPAN class="RktMod">#lang</SPAN></A><SPAN class="RktMeta"></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktMeta"></SPAN><A class="RktModLink" href="https://docs.racket-lang.org/ts-reference/index.html" data-pltdoc="x"><SPAN class="RktSym">typed/racket</SPAN></A><SPAN class="RktMeta"></SPAN></TD></tr></TBODY></TABLE></BLOCKQUOTE></DIV><DIV class="SIntrapara"><BLOCKQUOTE class="SCodeFlow"><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">:</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">String</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/function-contracts.html#%28form._%28%28lib._racket%2Fcontract%2Fbase..rkt%29._-~3e%29%29" data-pltdoc="x"><SPAN class="nobreak">-&gt;</SPAN></A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">String</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><TABLE class="RktBlk" cellspacing="0" cellpadding="0"><TBODY><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" data-pltdoc="x">define</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym"><A class="RktValLink" href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28quote._~23~25kernel%29._string-append%29%29" data-pltdoc="x">string-append</A></SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktSym">s</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">" snazzy suffix"</SPAN><SPAN class="RktPn">)</SPAN><SPAN class="RktPn">)</SPAN></TD></tr></TBODY></TABLE></TD></TR><TR><TD><SPAN class="stt">&gt; </SPAN><SPAN class="RktPn">(</SPAN><SPAN class="RktSym">misuse</SPAN><SPAN class="hspace">&nbsp;</SPAN><SPAN class="RktVal">0</SPAN><SPAN class="RktPn">)</SPAN></TD></tr><TR><TD><p><SPAN class="RktErr">eval:3:0: Type Checker: type mismatch</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">expected: String</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">given: Zero</SPAN></p></TD></tr><TR><TD><p><SPAN class="RktErr"></SPAN><SPAN class="hspace">&nbsp;&nbsp;</SPAN><SPAN class="RktErr">in: 0</SPAN></p></TD></tr></TBODY></TABLE></BLOCKQUOTE></DIV><p></p><p>Более того, Typed Racket может заранее обнаруживать ошибки при использовании
во время компиляции.</p>
<H4>7.2<TT>&nbsp;</TT><A 
name="(part._.Error-handling_strategies_for_macros)"></A>Стратегии обработки
ошибок для макросов</H4><p>Для макросов у нас есть аналогичные варианты.</p><p>1. Игнорировать возможность неправильного использования. Этот выбор еще хуже для
макросов. Сообщения об ошибках по умолчанию имеют еще меньшую точность, и ещё меньше
они помогают пользователю понять, что делать.</p><p>2. Написать код обработки ошибок. Мы видели, насколько это усложнит наши макросы в
нашем примере <A href="fear-of-macros.htm#%28part._hash..refs%29" 
data-pltdoc="x">использования точечной нотации для поиска по вложенным хешам</A>. И хотя
мы все еще учимся писать макросы, мы особенно не хотим большей когнитивной нагрузки и
запутывания.</p><p>3. Использовать <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>. Для макросов, это эквивалент использования
контракта или типов для функций. Мы можем объявить, что элементами входного образца
должны быть определенные виды вещей, такие как идентификаторы. Вместо "типов", виды
называются "синтаксическими классами/syntax classes". Существуют передопределенные
синтаксические классы, плюс мы можем определить свои собственные.</p>
<H4>7.3<TT>&nbsp;</TT><A name="(part._.Using_syntax-parse)"></A>Использование <SPAN 
class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN></H4><p>November 1, 2012: Так вот в чем дело. Написав все до этого момента, я счел
перечитать документацию для  <SPAN class="RktSym"><A 
class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>. Это было...очень понятна. Я всё понял.</p>
<p>Зачем? В документации есть хорошее <A href="http://docs.racket-lang.org/syntax/stxparse-intro.html">Введение</A>  с множеством примеров, за которым следует раздел <A href="http://docs.racket-lang.org/syntax/stxparse-examples.html">Примеров(Examples)</A> иллюстрируемый множеством реальных сценариев.</p><p><SPAN style="font-style: italic;">Обновление:</SPAN> Кроме того, Ben Greenman 
создал пакет, документы которого предоставляют отличный набор примеров синтаксического анализа <A href="http://docs.racket-lang.org/syntax-parse-example/index.html">Syntax
 Parse Examples</A>.</p><p>Кроме того, все, что я узнал до этого момента, подготовило меня к пониманию того, что
делает  <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>, и почему. Детали того, как его использовать, пока кажуться
довольно простыми.</p>
<p>Это может быть моё временное состояние: "не знаю, что я не знаю". 
По мере того, как я копаюсь использую это все больше, возможно я обнаружу
что-то запутанное или хитрое. Если/когда я это пойму, я вернусь сюда и 
обновлю этот текст.</p>
<p>Но сейчас, я сосредоточусь на улучшении предыдущих частей.</p><H3>8<TT>&nbsp;</TT><A 
name="(part._.References_and_.Acknowledgments)"></A>Ссылки и
благодарности</H3><p>Eli Barzilay’s blog post, <A href="http://blog.racket-lang.org/2011/04/writing-syntax-case-macros.html">Writing 
‘syntax-case’ Macros</A>, helped me understand many key details and concepts, 
and inspired me to use a "bottom-up" approach.</p><p>Eli wrote another blog post, <A href="http://blog.racket-lang.org/2008/02/dirty-looking-hygiene.html">Dirty
 Looking Hygiene</A>, which explains <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stxparam.html#%28form._%28%28lib._racket%2Fstxparam..rkt%29._syntax-parameterize%29%29" 
data-pltdoc="x">syntax-parameterize</A></SPAN>. I relied heavily on that, mostly 
just updating it since his post was written before PLT Scheme was renamed to 
Racket.</p>
<p>Matthew Flatt’s <A href="http://www.cs.utah.edu/plt/publications/macromod.pdf">Composable
 and Compilable Macros: You Want it When? (PDF)</A> explains how Racket handles 
compile time vs. run time.</p><p><A href="http://www.scheme.com/tspl4/syntax.html#./syntax:h0">Chapter 8</A> 
of <SPAN style="font-style: italic;">The Scheme Programming Language</SPAN> by 
Kent Dybvig explains <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-rules%29%29" 
data-pltdoc="x">syntax-rules</A></SPAN> and <SPAN class="RktSym"><A class="RktStxLink" 
href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax-case%29%29" 
data-pltdoc="x">syntax-case</A></SPAN>.</p>
<p><A href="http://www.ccs.neu.edu/racket/pubs/icfp10-cf.pdf">Fortifying Macros 
(PDF)</A> is the paper by Ryan Culpepper and Matthias Felleisen introducing 
<SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/syntax/Parsing_Syntax.html#%28form._%28%28lib._syntax%2Fparse..rkt%29._syntax-parse%29%29" 
data-pltdoc="x">syntax-parse</A></SPAN>.</p>
<p>Shriram Krishnamurthi looked at a very early draft and encouraged me to keep 
going. Sam Tobin-Hochstadt and Robby Findler also encouraged me. Matthew Flatt 
showed me how to make a Scribble <SPAN class="RktSym">interaction</SPAN> print <SPAN class="RktSym"><A class="RktStxLink" href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._syntax%29%29" 
data-pltdoc="x">syntax</A></SPAN> as <SPAN class="RktVal">"syntax"</SPAN> rather
 than as <SPAN class="RktVal">"#'"</SPAN>. Jay McCarthy helped me catch some 
mistakes and confusions. Jon Rafkind provided suggestions. Kieron Hardy reported 
a font issue and some typos.</p><p>Наконец я заметил что-то странное. После написания большей части этого эссе,
когда я вернулся к некоторым частям документации по Racket, я заметил, что она 
улучшилась с момента моего последнего прочтения. Конечно, она была той же самой;
изменился я. Интересно, сколько из того, что мы уже знаем проецируется между
строк. Я хочу сказать, что документация по Racket очень хорошая. <SPAN 
style="font-style: italic;">Guide</SPAN> содержит полелзные примеры и учебные
пособия. <SPAN style="font-style: italic;">Reference</SPAN> очень ясное и точное.</p></DIV></DIV><DIV id="contextindicator">&nbsp;</DIV></BODY></HTML>